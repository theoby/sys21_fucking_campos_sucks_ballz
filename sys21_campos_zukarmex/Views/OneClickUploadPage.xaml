<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:sys21_campos_zukarmex.ViewModels"
             xmlns:sync="clr-namespace:sys21_campos_zukarmex.Models.DTOs.Sync"
             x:Class="sys21_campos_zukarmex.Views.OneClickUploadPage"
             x:DataType="viewmodels:OneClickUploadViewModel"
             Title="Enviar Pendientes">

    <Grid RowDefinitions="Auto, *, Auto" Padding="20" RowSpacing="15">

        <StackLayout Grid.Row="0" Spacing="10">
            <Label Text="Sincronizar Registros Locales" FontSize="24" FontAttributes="Bold" TextColor="{DynamicResource Primary}" HorizontalOptions="Center" />
            <Label Text="{Binding SyncMessage}" FontSize="16" TextColor="{DynamicResource Gray600}" HorizontalOptions="Center" />
            <Label HorizontalOptions="Center" FontAttributes="Bold" FontSize="18">
                <Label.FormattedText>
                    <FormattedString>
                        <Span Text="Total Pendientes: " TextColor="{DynamicResource Gray800}"/>
                        <Span Text="{Binding TotalPendingCount}" TextColor="{DynamicResource Orange}" FontSize="24"/>
                    </FormattedString>
                </Label.FormattedText>
            </Label>
        </StackLayout>

        <Frame Grid.Row="1" BackgroundColor="White" CornerRadius="15" Padding="0" HasShadow="True">
            <CollectionView ItemsSource="{Binding UploadStatuses}" BackgroundColor="Transparent">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="sync:SyncStatus">
                        <Grid ColumnDefinitions="*,Auto" Padding="20,15">
                            <StackLayout VerticalOptions="Center">
                                <Label Text="{Binding CatalogName}" FontSize="16" FontAttributes="Bold" />
                                <Label Text="{Binding Status}" FontSize="12" TextColor="{DynamicResource Gray600}" />
                            </StackLayout>
                            <ActivityIndicator Grid.Column="1" IsRunning="False" IsVisible="{Binding IsCompleted, Converter={StaticResource InvertedBoolConverter}}" Color="{DynamicResource Primary}" VerticalOptions="Center" />
                            <Label Grid.Column="1" Text="✓" IsVisible="{Binding IsSuccess}" FontSize="35" TextColor="Green" VerticalOptions="Center" />
                            <Label Grid.Column="1" Text="✗" IsVisible="{Binding IsError}" FontSize="35" TextColor="Red" VerticalOptions="Center" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
                <CollectionView.EmptyView>
                    <StackLayout Padding="30" VerticalOptions="Center">
                        <Label Text="¡Todo Sincronizado!" FontSize="18" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                        <Label Text="No hay registros pendientes." HorizontalTextAlignment="Center"/>
                    </StackLayout>
                </CollectionView.EmptyView>
            </CollectionView>
        </Frame>

        <StackLayout Grid.Row="2">
            <Button Text="Enviar Todo a la API" 
                    Command="{Binding SendAllCommand}"
                    BackgroundColor="{DynamicResource Success}"
                    TextColor="White"
                    CornerRadius="10"
                    HeightRequest="50"
                    FontSize="16"
                    FontAttributes="Bold"
                    IsEnabled="{Binding HasPendingItems}" />

            <ActivityIndicator IsRunning="{Binding IsBusy}" IsVisible="{Binding IsBusy}" Color="{DynamicResource Primary}" HeightRequest="30" />
        </StackLayout>

    </Grid>
</ContentPage>