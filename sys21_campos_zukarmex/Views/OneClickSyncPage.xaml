<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:sys21_campos_zukarmex.ViewModels"
             xmlns:sync="clr-namespace:sys21_campos_zukarmex.Models.DTOs.Sync"
             x:Class="sys21_campos_zukarmex.Views.OneClickSyncPage"
             x:DataType="viewmodels:OneClickSyncViewModel"
             Title="{Binding Title}"
             BackgroundColor="{DynamicResource Gray100}">

    <Grid RowDefinitions="Auto, Auto, *, Auto" Padding="20">

        <StackLayout Grid.Row="0" Spacing="10" Margin="0,20,0,30">
            <Label Text="Actualizar Catálogos" 
                   FontSize="24" FontAttributes="Bold"
                   TextColor="{DynamicResource Primary}"
                   HorizontalOptions="Center" />
            <Label Text="{Binding SyncMessage}" 
                   FontSize="16" 
                   TextColor="{DynamicResource Gray600}"
                   HorizontalOptions="Center" />
        </StackLayout>

        <Frame Grid.Row="1" BackgroundColor="White" CornerRadius="15" Padding="20" HasShadow="True">
            <StackLayout Spacing="10">
                <Label Text="Progreso General" FontSize="18" FontAttributes="Bold" />
                <ProgressBar Progress="{Binding OverallProgress, Converter={StaticResource PercentToProgressConverter}}" 
                             ProgressColor="{DynamicResource Primary}" 
                             HeightRequest="10" />
                <Label Text="{Binding OverallProgress, StringFormat='{0}%'}" 
                       FontSize="14" 
                       HorizontalOptions="Center" />
            </StackLayout>
        </Frame>

        <Frame Grid.Row="2" BackgroundColor="White" CornerRadius="15" Margin="0,10,0,0" Padding="0" HasShadow="True">
            <CollectionView ItemsSource="{Binding SyncStatuses}" BackgroundColor="Transparent">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="sync:SyncStatus">
                        <Grid ColumnDefinitions="*,Auto" Padding="20,15">
                            <StackLayout VerticalOptions="Center">
                                <Label Text="{Binding CatalogName}" FontSize="16" FontAttributes="Bold" />
                                <Label Text="{Binding Status}" FontSize="12" TextColor="{DynamicResource Gray600}" />
                            </StackLayout>

                            <ActivityIndicator Grid.Column="1" IsRunning="True"
                                               IsVisible="{Binding IsCompleted, Converter={StaticResource InvertedBoolConverter}}"
                                               Color="{DynamicResource Primary}" VerticalOptions="Center" />
                            <Label Grid.Column="1" Text="✓" IsVisible="{Binding IsSuccess}" FontSize="35" TextColor="Green" VerticalOptions="Center" />
                            <Label Grid.Column="1" Text="✗" IsVisible="{Binding IsError}" FontSize="35" TextColor="Red" VerticalOptions="Center" />
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Frame>

        <StackLayout Grid.Row="3" Margin="0,20,0,0">
            <Button Text="Actualizar Catálogos" 
                    Command="{Binding StartSyncCommand}"
                    BackgroundColor="{DynamicResource Primary}"
                    TextColor="White"
                    CornerRadius="10"
                    HeightRequest="50"
                    FontSize="16"
                    FontAttributes="Bold"
                    IsEnabled="{Binding IsSyncCompleted}" />

            <ActivityIndicator IsRunning="{Binding IsBusy}" 
                               IsVisible="{Binding IsBusy}"
                               Color="{DynamicResource Primary}"
                               HeightRequest="30" />
        </StackLayout>

    </Grid>
</ContentPage>