<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="sys21_campos_zukarmex.Views.DamageAssessment.DamageAssessmentPage"
             xmlns:viewmodels="clr-namespace:sys21_campos_zukarmex.ViewModels"
             xmlns:behaviors="clr-namespace:sys21_campos_zukarmex.Behaviors"
             x:DataType="viewmodels:DamageAssessmentViewModel"
             Title="{Binding Title}"
             
             >
    <Grid RowDefinitions="*">

        <ScrollView Grid.Row="0">
            <StackLayout Spacing="20" Padding="20">

                <Frame BackgroundColor="{DynamicResource Primary}" CornerRadius="15" HasShadow="True">
                    <Label Text="Muestreo de Daño" FontSize="20" FontAttributes="Bold" TextColor="White" HorizontalOptions="Center"/>
                </Frame>

                <Frame BackgroundColor="White" CornerRadius="15" Padding="20" HasShadow="True">
                    <StackLayout Spacing="15">

                        <StackLayout>
                            <Label Text="Predio" FontSize="14" TextColor="{StaticResource Gray600}" />
                            <Frame BackgroundColor="{StaticResource Gray100}" CornerRadius="10" Padding="0" HasShadow="False">
                                <Picker ItemsSource="{Binding Campos}" 
                                        SelectedItem="{Binding SelectedCampo}" 
                                        ItemDisplayBinding="{Binding Nombre}" 
                                        Title="Seleccione un predio" 
                                        FontSize="16"
                                        BackgroundColor="Transparent"
                                        TitleColor="{StaticResource Gray600}" />
                            </Frame>
                        </StackLayout>
                        <StackLayout>
                            <Label Text="Zafra" FontSize="14" TextColor="{StaticResource Gray600}" />
                            <Frame BackgroundColor="{StaticResource Gray100}" CornerRadius="10" Padding="0" HasShadow="False">
                                <Picker ItemsSource="{Binding Zafras}" 
                                        SelectedItem="{Binding SelectedZafra}" 
                                        ItemDisplayBinding="{Binding Nombre}" 
                                        Title="Seleccione una zafra" 
                                        FontSize="16"
                                        BackgroundColor="Transparent"
                                        TitleColor="{StaticResource Gray600}" />
                            </Frame>
                        </StackLayout>
                        <StackLayout>
                            <Label Text="Campo"
                                   FontSize="14"
                                   TextColor="{StaticResource Gray600}" />
                            <Frame BackgroundColor="{StaticResource Gray100}"
                                   CornerRadius="10"
                                   Padding="0"
                                   HasShadow="False">
                                <Picker ItemsSource="{Binding Lotes}"
                                        SelectedItem="{Binding SelectedLote}"
                                        ItemDisplayBinding="{Binding Nombre}"
                                        Title="Seleccione una campo"
                                        FontSize="16"
                                        BackgroundColor="Transparent"
                                        TitleColor="{StaticResource Gray600}" />
                            </Frame>
                        </StackLayout>
                        <StackLayout>
                            <Label Text="Ciclo" FontSize="14" TextColor="{StaticResource Gray600}" />
                            <Frame BackgroundColor="{StaticResource Gray100}" CornerRadius="10" Padding="0" HasShadow="False">
                                <Picker ItemsSource="{Binding Ciclos}" 
                                        SelectedItem="{Binding SelectedCiclo}" 
                                        ItemDisplayBinding="{Binding Nombre}" 
                                        Title="Seleccione un ciclo" 
                                        FontSize="16"
                                        BackgroundColor="Transparent"
                                        TitleColor="{StaticResource Gray600}" />
                            </Frame>
                        </StackLayout>

                        <StackLayout>
                            <Label Text="Fecha" FontSize="14" TextColor="{StaticResource Gray600}" />
                            <Frame BackgroundColor="{StaticResource Gray100}" CornerRadius="10" Padding="0" HasShadow="False">
                                <DatePicker Date="{Binding Fecha}" Format="dd/MM/yyyy" FontSize="16" />
                            </Frame>
                        </StackLayout>

                        <StackLayout>
                            <Label Text="Superficie" FontSize="14" TextColor="{StaticResource Gray600}" />
                            <Frame BackgroundColor="{StaticResource Gray100}" CornerRadius="10" Padding="0" HasShadow="False">
                                <Entry Text="{Binding Superficie}"
                                       Placeholder="0"
                                       Keyboard="Numeric"
                                       FontSize="16"
                                       HorizontalTextAlignment="Center"
                                       BackgroundColor="Transparent"
                                       PlaceholderColor="{StaticResource Gray600}"
                                       IsReadOnly="True">
                                    <Entry.Behaviors>
                                        <behaviors:NumericValidationBehavior />
                                    </Entry.Behaviors>
                                </Entry>
                            </Frame>
                        </StackLayout>

                        <StackLayout>
                            <Label Text="N° de tallos" FontSize="14" TextColor="{StaticResource Gray600}" />
                            <Frame BackgroundColor="{StaticResource Gray100}" CornerRadius="10" Padding="0" HasShadow="False">
                                <Entry Text="{Binding NumeroTallos}" 
                                       Placeholder="0" 
                                       Keyboard="Numeric" 
                                       FontSize="16" 
                                       HorizontalTextAlignment="Center"
                                       BackgroundColor="Transparent"
                                       PlaceholderColor="{StaticResource Gray600}">
                                    <Entry.Behaviors>
                                        <behaviors:NumericValidationBehavior />
                                    </Entry.Behaviors>
                                </Entry>
                            </Frame>
                        </StackLayout>

                        <Label Text="N° de daños" FontSize="14" FontAttributes="Bold" TextColor="{StaticResource Gray800}" />
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                            <StackLayout Grid.Column="0">
                                <Label Text="Daño Viejo" FontSize="14" TextColor="{StaticResource Gray600}" />
                                <Frame BackgroundColor="{StaticResource Gray100}" CornerRadius="10" Padding="0" HasShadow="False">
                                    <Entry Text="{Binding DanoViejo}" 
                                           Placeholder="0" 
                                           Keyboard="Numeric" 
                                           FontSize="16" 
                                           HorizontalTextAlignment="Center"
                                           BackgroundColor="Transparent"
                                           PlaceholderColor="{StaticResource Gray600}">
                                        <Entry.Behaviors>
                                            <behaviors:NumericValidationBehavior />
                                        </Entry.Behaviors>
                                    </Entry>
                                </Frame>
                            </StackLayout>
                            <StackLayout Grid.Column="1">
                                <Label Text="Daño Nuevo" FontSize="14" TextColor="{StaticResource Gray600}" />
                                <Frame BackgroundColor="{StaticResource Gray100}" CornerRadius="10" Padding="0" HasShadow="False">
                                    <Entry Text="{Binding DanoNuevo}" 
                                           Placeholder="0" 
                                           Keyboard="Numeric" 
                                           FontSize="16" 
                                           HorizontalTextAlignment="Center"
                                           BackgroundColor="Transparent"
                                           PlaceholderColor="{StaticResource Gray600}">
                                        <Entry.Behaviors>
                                            <behaviors:NumericValidationBehavior />
                                        </Entry.Behaviors>
                                    </Entry>
                                </Frame>
                            </StackLayout>
                        </Grid>

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                            <Frame Grid.Column="0" BackgroundColor="{StaticResource Gray500}" CornerRadius="10" Padding="10" HasShadow="False">
                                <StackLayout HorizontalOptions="Center" VerticalOptions="Center">
                                    <Label Text="Total Daño" TextColor="White" FontAttributes="Bold" FontSize="18" HorizontalOptions="Center" />
                                    <Label Text="{Binding TotalDano}" TextColor="White" FontAttributes="Bold" FontSize="24" HorizontalOptions="Center" />
                                </StackLayout>
                            </Frame>
                            <Frame Grid.Column="1" BackgroundColor="{StaticResource Gray500}" CornerRadius="10" Padding="10" HasShadow="False">
                                <StackLayout HorizontalOptions="Center" VerticalOptions="Center">
                                    <Label Text="% daño" TextColor="White" FontAttributes="Bold" FontSize="18" HorizontalOptions="Center" />
                                    <Label Text="{Binding PorcentajeDano, StringFormat='{0:P1}'}" TextColor="White" FontAttributes="Bold" FontSize="24" HorizontalOptions="Center" />
                                </StackLayout>
                            </Frame>
                        </Grid>

                    </StackLayout>
                </Frame>

                <Button Text="+ Agregar" 
                    Command="{Binding AddAssessmentCommand}"
                    BackgroundColor="{StaticResource Primary}" TextColor="White" CornerRadius="25"
                    HeightRequest="50" FontSize="18" FontAttributes="Bold" Margin="0,10,0,0"/>

            </StackLayout>
        </ScrollView>

        <ActivityIndicator Grid.Row="0"
                           IsRunning="{Binding IsBusy}" 
                           IsVisible="{Binding IsBusy}" 
                           Color="{StaticResource Primary}" 
                           VerticalOptions="Center" 
                           HorizontalOptions="Center" />
    </Grid>
</ContentPage>